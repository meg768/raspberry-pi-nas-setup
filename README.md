# Raspberry Pi NAS + Time Machine Setup

> *This guide was generated by ChatGPT to help document a full NAS and Time Machine setup on a Raspberry Pi.*

This guide sets up a Raspberry Pi named `pi-nas` as a NAS server with:
- A Time Machine-compatible backup share
- A general-purpose file share
- One user: `magnus`, with full access to all shares and backup capability

## ğŸ“¦ Requirements
- Raspberry Pi running Raspberry Pi OS (headless is fine)
- External hard drive mounted at `/mnt/samsung`
- macOS device for testing

---

## ğŸ§° Step 1: Install Samba and Avahi
```bash
sudo apt update
sudo apt install samba samba-common-bin avahi-daemon -y
sudo systemctl enable avahi-daemon
sudo systemctl start avahi-daemon
```

---

## ğŸ‘¤ Step 2: Create User
```bash
sudo adduser magnus
sudo smbpasswd -a magnus
```

---

## ğŸ—‚ï¸ Step 3: Create Shared Folders
```bash
sudo mkdir -p /mnt/samsung/timemachine
sudo mkdir -p /mnt/samsung/shared

sudo chown -R magnus:magnus /mnt/samsung/timemachine
sudo chown -R magnus:magnus /mnt/samsung/shared
sudo chmod -R 770 /mnt/samsung/timemachine
sudo chmod -R 775 /mnt/samsung/shared
```

---

## âš™ï¸ Step 4: Configure Samba
Edit Samba config:
```bash
sudo nano /etc/samba/smb.conf
```
Append this to the end:
```ini
[timemachine]
   path = /mnt/samsung/timemachine
   valid users = magnus
   writeable = yes
   browsable = yes
   guest ok = no
   create mask = 0660
   directory mask = 0770
   vfs objects = catia fruit streams_xattr
   fruit:resource = xattr
   fruit:metadata = stream
   fruit:locking = none
   fruit:time machine = yes
   fruit:time machine max size = 500G

[shared]
   path = /mnt/samsung/shared
   valid users = magnus
   writeable = yes
   browsable = yes
   guest ok = no
   create mask = 0664
   directory mask = 0775
```
Save and close.

---

## ğŸ” Step 5: Restart Samba
```bash
sudo systemctl restart smbd
```

---

## ğŸ–¥ï¸ Step 6: Connect from macOS
- Open Finder â†’ Go â†’ Connect to Server
- Enter: `smb://pi-nas.local/shared` or `smb://pi-nas.local/timemachine`
- Login as `magnus`

To enable Time Machine:
- Go to **System Settings > Time Machine > Add Disk**
- Select `timemachine` share and enter the `magnus` credentials

---

## âœ… Result
- `magnus`: full access to Time Machine backups and general file sharing
- Pi is discoverable via Bonjour (Avahi)

---

## ğŸ“ Optional Next Steps
- Auto-mount shares on macOS
- Encrypt backups
- Add read-only media share

---

## ğŸ“‚ Folder Structure
```
/mnt/samsung
â”œâ”€â”€ timemachine
â””â”€â”€ shared
```

---

Happy hacking! ğŸ§ğŸ¾
